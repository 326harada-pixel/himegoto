
window.himeInitCommonUI=function(){const $=(s)=>document.querySelector(s);const on=(el,ev,fn)=>el&&el.addEventListener(ev,fn);const d=$('#drawer'),o=$('#drawerOverlay'),mb=$('#menuBtn'),xb=$('#menuCloseBtn');function openD(){d.classList.add('open');d.setAttribute('aria-hidden','false');o.classList.add('show');document.body.style.overflow='hidden';}function closeD(){d.classList.remove('open');d.setAttribute('aria-hidden','true');o.classList.remove('show');document.body.style.overflow='';}on(mb,'click',openD);on(xb,'click',closeD);on(o,'click',closeD);on(document,'keydown',e=>{if(e.key==='Escape')closeD();});let DP=null;const ib=$('#installBtn');const isStandalone=()=> (window.matchMedia&&window.matchMedia('(display-mode: standalone)').matches)||(window.navigator.standalone===true);function hideI(){ib&&(ib.style.display='none');}function showI(){ib&&(ib.style.display='');}window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();DP=e;if(!isStandalone())showI();});window.addEventListener('appinstalled',()=>{DP=null;hideI();localStorage.setItem('hime_installed','1');});if(isStandalone()||localStorage.getItem('hime_installed')==='1'){hideI();}on(ib,'click',async()=>{if(!DP)return;DP.prompt();await DP.userChoice;DP=null;hideI();});try{const k='hime_beta_notice_date',t=new Date().toISOString().slice(0,10);if(localStorage.getItem(k)!==t){alert('現在ベータ版のため、内部を不定期で更新しています。急に使えなくなる・画面が崩れる場合があります。ご了承ください。');localStorage.setItem(k,t);}}catch{}};
